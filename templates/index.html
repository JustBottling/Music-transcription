<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Music Transcriber</title>
</head>
<body>
  <h1>Music Transcriber</h1>

  <!-- Prominent supported formats notice -->
  <div style="border: 2px solid #4A90E2; padding: 15px; background-color: #EAF4FB; margin-bottom: 20px; border-radius: 5px; max-width: 400px;">
    <strong>Supported audio formats:</strong>
    <ul style="margin: 10px 0 0 20px;">
      <li>WAV (.wav)</li>
      <li>MP3 (.mp3)</li>
      <li>FLAC (.flac)</li>
    </ul>
  </div>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul style="color:red;">
      {% for msg in messages %}
        <li>{{ msg }}</li>
      {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <form method="post" enctype="multipart/form-data">
    <label for="audio">Choose an audio file to transcribe:</label><br>
    <input type="file" id="audio" name="audio" accept=".wav,.mp3,.flac" required><br><br>
    <button type="submit">Transcribe</button>
  </form>

  {% if audio_file %}
    <h2>Results for {{ audio_file }}</h2>

    <h3>Original Audio Playback</h3>
    <audio controls>
      <source src="{{ url_for('static_files', filename=audio_file) }}" type="audio/{{ audio_file.rsplit('.',1)[1] }}">
      Your browser does not support the audio element.
    </audio>

    <h3>Waveform</h3>
    <img src="{{ url_for('static_files', filename=audio_file) }}" style="max-width:600px;" alt="Audio waveform">

    <h3>MIDI Download</h3>
    <a href="{{ url_for('static_files', filename=midi_file) }}" download>Download MIDI</a>

    <h3>Sheet Music Preview</h3>

    <!-- ↓ Only show this image if png_file is set: -->
    <mark>{% raw %}{% if png_file %}{% endraw %}</mark>
      <img
        src="{{ url_for('static_files', filename=png_file) }}"
        style="max-width:600px;"
        alt="Sheet music preview">
    <mark>{% raw %}{% endif %}{% endraw %}</mark>
    <!-- ↑ end conditional -->

    <p><a href="{{ url_for('static_files', filename=xml_file) }}" download>Download MusicXML</a></p>
  {% endif %}
</body>
</html>
